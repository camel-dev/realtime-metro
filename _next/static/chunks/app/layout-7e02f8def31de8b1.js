(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4110:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var i=n(5155),r=n(2115);function l(e){let{onSidebarToggle:t}=e;return(0,i.jsx)("nav",{style:{padding:16,background:"#fff",borderBottom:"1px solid #eee",display:"flex",alignItems:"center"},children:(0,i.jsxs)("button",{onClick:t,"aria-label":"노선 선택",style:{background:"#0052A4",color:"#fff",border:"none",borderRadius:8,padding:"8px 18px 8px 44px",fontSize:16,fontWeight:600,cursor:"pointer",position:"relative",boxShadow:"0 2px 8px 0 rgba(0,0,0,0.07)",marginRight:16,transition:"background 0.2s"},onMouseOver:e=>e.currentTarget.style.background="#003c7a",onMouseOut:e=>e.currentTarget.style.background="#0052A4",children:[(0,i.jsx)("span",{style:{position:"absolute",left:18,top:"50%",transform:"translateY(-50%)",width:18,height:18,display:"inline-block"},children:(0,i.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:[(0,i.jsx)("rect",{y:"3",width:"18",height:"2.5",rx:"1.2",fill:"#fff"}),(0,i.jsx)("rect",{y:"8",width:"18",height:"2.5",rx:"1.2",fill:"#fff"}),(0,i.jsx)("rect",{y:"13",width:"18",height:"2.5",rx:"1.2",fill:"#fff"})]})}),"노선 선택"]})})}let o={1:"#0052A4",2:"#009D3E",3:"#EF7C1C",4:"#00A5DE",5:"#996CAC",6:"#CD7C2F",7:"#747F00",8:"#E6186C"},a=Object.keys(o).map(e=>({name:"".concat(e,"호선"),color:o[e],short:e}));function s(e){let{open:t,onClose:n,onSelectLine:r}=e;return t?(0,i.jsxs)("aside",{style:{position:"fixed",left:0,top:0,width:270,height:"100vh",background:"#f7f9fb",zIndex:1e3,padding:28,boxShadow:"2px 0 16px 0 rgba(0,0,0,0.07)",overflowY:"auto",fontFamily:"Pretendard, sans-serif"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:28},children:[(0,i.jsx)("h3",{style:{margin:0,fontSize:22,fontWeight:700,color:"#222"},children:"서울 지하철 노선"}),(0,i.jsx)("button",{onClick:n,"aria-label":"닫기",style:{background:"none",border:"none",fontSize:28,cursor:"pointer",color:"#888",lineHeight:1,padding:0},children:"\xd7"})]}),(0,i.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:a.map(e=>(0,i.jsxs)("li",{onClick:()=>{r(e.short),n()},style:{cursor:"pointer",margin:"10px 0",display:"flex",alignItems:"center",borderRadius:10,padding:"8px 12px",transition:"background 0.15s",fontWeight:500,fontSize:16,userSelect:"none",boxShadow:"0 1px 2px rgba(0,0,0,0.03)"},onMouseOver:e=>e.currentTarget.style.background="#e6eef7",onMouseOut:e=>e.currentTarget.style.background="transparent",children:[(0,i.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50%",background:e.color,color:"#fff",fontWeight:700,fontSize:16,marginRight:14,border:"2px solid #fff",boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",textAlign:"center",lineHeight:1},children:e.short}),(0,i.jsx)("span",{style:{letterSpacing:.5},children:e.name})]},e.short))})]}):null}let d={1:"/realtime-metro/img/line1_v4.png",2:"/realtime-metro/img/line2_v4.png",3:"/realtime-metro/img/line3_v4.png",4:"/realtime-metro/img/line4_v4.png",5:"/realtime-metro/img/line5_v4.png",6:"/realtime-metro/img/line6_v4.png",7:"/realtime-metro/img/line7_v4.png",8:"/realtime-metro/img/line8_v4.png"},c={1:"#0052A4",2:"#00A84D",3:"#EF7C1C",4:"#00A2D1",5:"#996CAC",6:"#CD7C2F",7:"#747F00",8:"#E6186C"};function u(e){let{selectedLine:t}=e,[n,l]=(0,r.useState)(1),o=(0,r.useRef)(null),[a,s]=(0,r.useState)({width:1,height:1}),u={width:1200,height:800},h=(0,r.useRef)(null),g=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!h.current)return;let e=()=>{s({width:h.current.width,height:h.current.height})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]);let[p,f]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!t)return;let e=async()=>{try{let e="".concat(t,"호선"),n=await fetch("https://metro.jys5540.workers.dev/?line=".concat(e)),i=await n.text(),r=new DOMParser().parseFromString(i,"text/xml"),l=Array.from(r.getElementsByTagName("row")).map(e=>{var t,n,i,r,l,o,a,s,d,c,u,h;return{trainId:null!=(a=null==(t=e.getElementsByTagName("trainNo")[0])?void 0:t.textContent)?a:"",statnNm:null!=(s=null==(n=e.getElementsByTagName("statnNm")[0])?void 0:n.textContent)?s:"",statnTnm:null!=(d=null==(i=e.getElementsByTagName("statnTnm")[0])?void 0:i.textContent)?d:"",updnLine:null!=(c=null==(r=e.getElementsByTagName("updnLine")[0])?void 0:r.textContent)?c:"",directAt:null!=(u=null==(l=e.getElementsByTagName("directAt")[0])?void 0:l.textContent)?u:"",trainSttus:null!=(h=null==(o=e.getElementsByTagName("trainSttus")[0])?void 0:o.textContent)?h:""}}),o=new Map;l.forEach(e=>{let t="".concat(e.trainId,"-").concat(e.statnNm);o.has(t)||o.set(t,e)});let a=Array.from(o.values());console.warn(a),f(a)}catch(e){f([])}};e();let n=setInterval(e,1e4);return()=>clearInterval(n)},[]);let[x,m]=(0,r.useState)([]);return((0,r.useEffect)(()=>{"1"===t?fetch("/realtime-metro/line1_all_station_coords_updated.json").then(e=>e.json()).then(m):m([])},[t]),t&&d[t])?(0,i.jsx)("div",{ref:g,style:{width:"100vw",height:"calc(100dvh - 56px)",overflow:"auto",position:"relative",background:"#fafbfc"},onTouchStart:e=>{if(1===e.touches.length);else if(2===e.touches.length){let t=e.touches[0].clientX-e.touches[1].clientX,i=e.touches[0].clientY-e.touches[1].clientY;o.current={distance:Math.sqrt(t*t+i*i),scale:n}}},onTouchMove:e=>{if(1===e.touches.length);else if(2===e.touches.length&&o.current){let t=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY,i=Math.sqrt(t*t+n*n);l(Math.max(.5,Math.min(3,o.current.scale*(i/o.current.distance))))}},onTouchEnd:e=>{o.current=null},children:(0,i.jsxs)("div",{style:{position:"relative",width:"".concat(u.width*n,"px"),height:"".concat(u.height*n,"px")},children:[(0,i.jsx)("img",{ref:h,src:d[t],alt:"".concat(t,"호선 노선도"),style:{width:"100%",height:"100%",boxShadow:"0 4px 24px #0001",borderRadius:16,userSelect:"none",display:"block",cursor:"default"},draggable:!1,onLoad:()=>{h.current&&s({width:h.current.naturalWidth,height:h.current.naturalHeight})},onClick:e=>{var t,i,r,l;let o=e.currentTarget.getBoundingClientRect(),a=e.clientX-o.left,s=e.clientY-o.top,d=null!=(r=null==(t=g.current)?void 0:t.scrollLeft)?r:0,c=null!=(l=null==(i=g.current)?void 0:i.scrollTop)?l:0;console.log("x: ".concat(Math.round((a+d)/n)-1,", y: ").concat(Math.round((s+c)/n)-1))}}),p.map(e=>{let l=x.filter(t=>"구로"===t.name?t.name===e.statnNm:t.name===e.statnNm&&t.trainSttus===e.trainSttus&&t.updnLine===e.updnLine);if(0===l.length)return null;let o=l[0],a=o.x*n,s=o.y*n,d=0,u=0;"2"!==t&&(["시청","서울","남영","용산","도봉산","도봉","방학","창동","녹천","월계","광운대","석계","가산디지털단지","독산","관악","안양","명학","금정","동암","간석","주안","도화"].includes(e.statnNm)?"0"===e.updnLine?d=-10:"1"===e.updnLine&&(d=13):"0"===e.updnLine?u=-5:"1"===e.updnLine&&(u=10));let h=a+d,g=s+u,p=c[t]||"#43a047",f="",m=p;"2"===t?"0"===e.updnLine?(f="↺",m=p):"1"===e.updnLine&&(f="↻",m=p):"0"===e.updnLine?(f="▲",m="#EF7C1C"):"1"===e.updnLine&&(f="▼",m="#00A2D1");let b="1"===e.directAt||"7"===e.directAt,y="".concat(e.trainId,"-").concat(e.statnNm);return(0,i.jsx)(r.Fragment,{children:(0,i.jsx)("div",{style:{position:"absolute",left:h-10,top:g-7,width:20,height:14,pointerEvents:"none",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center"},title:e.trainId,children:(0,i.jsxs)("div",{style:{width:30,height:10,background:"rgba(255,255,255,0.7)",borderRadius:"10px 10px 10px 10px / 16px 16px 16px 16px",border:b?"1px solid #e53935":"1px solid ".concat(p),boxShadow:"0 2px 8px #0002",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,i.jsxs)("span",{style:{fontSize:5,color:b?"#e53935":p,fontWeight:900,whiteSpace:"nowrap",textShadow:"0 2px 4px #fff",display:"flex",alignItems:"center"},children:[e.statnTnm,(0,i.jsx)("span",{style:{marginLeft:1,fontSize:5,fontWeight:"bold",color:m},children:f})]}),(0,i.jsx)("div",{style:{position:"absolute",left:2,bottom:-3,width:3,height:3,background:"#bbb",borderRadius:"50%"}}),(0,i.jsx)("div",{style:{position:"absolute",right:2,bottom:-3,width:3,height:3,background:"#bbb",borderRadius:"50%"}})]})})},y)})]})}):(0,i.jsx)("div",{style:{textAlign:"center",marginTop:100,color:"#888"},children:"노선을 선택하세요."})}function h(e){let{children:t}=e,[n,o]=(0,r.useState)(!1),[a,d]=(0,r.useState)("1");return(0,i.jsx)("html",{lang:"en",children:(0,i.jsxs)("body",{style:{margin:0,overflow:"hidden"},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",zIndex:100,height:56,background:"#fff"},children:(0,i.jsx)(l,{onSidebarToggle:()=>o(!0)})}),(0,i.jsx)(s,{open:n,onClose:()=>o(!1),onSelectLine:e=>{d(e)}}),(0,i.jsx)("div",{style:{transition:"padding-left 0.3s",paddingLeft:290*!!n,minHeight:"100dvh",boxSizing:"border-box",background:"#f5f6fa",paddingTop:56},children:(0,i.jsx)(u,{selectedLine:a})})]})})}},6649:(e,t,n)=>{Promise.resolve().then(n.bind(n,4110))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(6649)),_N_E=e.O()}]);